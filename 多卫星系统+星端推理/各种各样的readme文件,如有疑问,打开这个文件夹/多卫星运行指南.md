# å¤šå«æ˜Ÿæ¨ç†ç³»ç»Ÿè¯¦ç»†è¿è¡ŒæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

é¦–å…ˆç¡®ä¿å®‰è£…äº†æ‰€æœ‰å¿…è¦çš„ä¾èµ–ï¼š

```bash
# å®‰è£…åŸºç¡€ä¾èµ–
pip install torch torchvision torchaudio
pip install numpy matplotlib pillow
pip install segmentation-models-pytorch
pip install psutil openpyxl

# æ£€æŸ¥CUDAæ”¯æŒï¼ˆå¯é€‰ï¼‰
python -c "import torch; print(f'CUDAå¯ç”¨: {torch.cuda.is_available()}')"
```

### 2. æ£€æŸ¥æ¨¡å‹æ–‡ä»¶

ç¡®ä¿æ¨¡å‹æ–‡ä»¶å­˜åœ¨ï¼š

```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
ls -la models/best_multimodal_patch_model.pth

# å¦‚æœæ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆè®­ç»ƒæ¨¡å‹æˆ–ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹
```

### 3. å¯åŠ¨å«æ˜ŸæœåŠ¡å™¨

#### æ–¹æ³•ä¸€ï¼šå•æœºæ¨¡æ‹Ÿå¤šå«æ˜Ÿï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰

æ‰“å¼€ä¸‰ä¸ªç»ˆç«¯çª—å£ï¼Œåˆ†åˆ«è¿è¡Œï¼š

```bash
# ç»ˆç«¯1 - å«æ˜Ÿ001
python satellite_inference_server.py --host 127.0.0.1 --port 8080 --satellite_id sat_001 --model models/best_multimodal_patch_model.pth

# ç»ˆç«¯2 - å«æ˜Ÿ002  
python satellite_inference_server.py --host 127.0.0.1 --port 8081 --satellite_id sat_002 --model models/best_multimodal_patch_model.pth

# ç»ˆç«¯3 - å«æ˜Ÿ003
python satellite_inference_server.py --host 127.0.0.1 --port 8082 --satellite_id sat_003 --model models/best_multimodal_patch_model.pth
```

#### æ–¹æ³•äºŒï¼šçœŸå®å¤šå«æ˜Ÿéƒ¨ç½²

åœ¨æ¯ä¸ªå«æ˜Ÿä¸Šè¿è¡Œï¼š

```bash
# å«æ˜Ÿ001 (IP: 192.168.1.101)
python satellite_inference_server.py --host 0.0.0.0 --port 8080 --satellite_id sat_001

# å«æ˜Ÿ002 (IP: 192.168.1.102)
python satellite_inference_server.py --host 0.0.0.0 --port 8080 --satellite_id sat_002

# å«æ˜Ÿ003 (IP: 192.168.1.103)
python satellite_inference_server.py --host 0.0.0.0 --port 8080 --satellite_id sat_003
```

### 4. é…ç½®åœ°é¢æ§åˆ¶ä¸­å¿ƒ

ä¿®æ”¹ `multi_satellite_config.json` æ–‡ä»¶ä¸­çš„å«æ˜ŸIPåœ°å€ï¼š

```json
{
  "satellites": {
    "sat_001": {
      "ip": "127.0.0.1",  // å•æœºæµ‹è¯•ç”¨
      "port": 8080
    },
    "sat_002": {
      "ip": "127.0.0.1",  // å•æœºæµ‹è¯•ç”¨
      "port": 8081
    },
    "sat_003": {
      "ip": "127.0.0.1",  // å•æœºæµ‹è¯•ç”¨
      "port": 8082
    }
  }
}
```

### 5. å¯åŠ¨åœ°é¢æ§åˆ¶ä¸­å¿ƒ

```bash
python multi_satellite_inference.py
```

## ğŸ“‹ è¯¦ç»†è¿è¡Œæ­¥éª¤

### æ­¥éª¤1ï¼šç¯å¢ƒæ£€æŸ¥

```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version

# æ£€æŸ¥PyTorchå®‰è£…
python -c "import torch; print(f'PyTorchç‰ˆæœ¬: {torch.__version__}')"

# æ£€æŸ¥CUDAæ”¯æŒ
python -c "import torch; print(f'CUDAå¯ç”¨: {torch.cuda.is_available()}')"

# æ£€æŸ¥ä¾èµ–åŒ…
python -c "import segmentation_models_pytorch as smp; print('smpå¯¼å…¥æˆåŠŸ')"
```

### æ­¥éª¤2ï¼šæ¨¡å‹æ–‡ä»¶æ£€æŸ¥

```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la models/

# å¦‚æœæ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥ï¼š
# 1. ä½¿ç”¨ç°æœ‰çš„æ¨¡å‹æ–‡ä»¶
# 2. è®­ç»ƒæ–°æ¨¡å‹
# 3. ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹
```

### æ­¥éª¤3ï¼šå¯åŠ¨å«æ˜ŸæœåŠ¡å™¨

#### 3.1 å•æœºæµ‹è¯•æ¨¡å¼

åˆ›å»ºå¯åŠ¨è„šæœ¬ `start_satellites.sh`ï¼š

```bash
#!/bin/bash

# å¯åŠ¨å«æ˜Ÿ001
echo "å¯åŠ¨å«æ˜Ÿ001..."
python satellite_inference_server.py --host 127.0.0.1 --port 8080 --satellite_id sat_001 &
SAT1_PID=$!

# å¯åŠ¨å«æ˜Ÿ002
echo "å¯åŠ¨å«æ˜Ÿ002..."
python satellite_inference_server.py --host 127.0.0.1 --port 8081 --satellite_id sat_002 &
SAT2_PID=$!

# å¯åŠ¨å«æ˜Ÿ003
echo "å¯åŠ¨å«æ˜Ÿ003..."
python satellite_inference_server.py --host 127.0.0.1 --port 8082 --satellite_id sat_003 &
SAT3_PID=$!

echo "æ‰€æœ‰å«æ˜Ÿå·²å¯åŠ¨"
echo "å«æ˜Ÿ001 PID: $SAT1_PID"
echo "å«æ˜Ÿ002 PID: $SAT2_PID"
echo "å«æ˜Ÿ003 PID: $SAT3_PID"

# ç­‰å¾…ç”¨æˆ·ä¸­æ–­
echo "æŒ‰ Ctrl+C åœæ­¢æ‰€æœ‰å«æ˜Ÿ"
trap "kill $SAT1_PID $SAT2_PID $SAT3_PID; echo 'æ‰€æœ‰å«æ˜Ÿå·²åœæ­¢'; exit" INT
wait
```

è¿è¡Œå¯åŠ¨è„šæœ¬ï¼š

```bash
chmod +x start_satellites.sh
./start_satellites.sh
```

#### 3.2 æ‰‹åŠ¨å¯åŠ¨æ¨¡å¼

åœ¨ä¸‰ä¸ªä¸åŒçš„ç»ˆç«¯çª—å£ä¸­åˆ†åˆ«è¿è¡Œï¼š

```bash
# ç»ˆç«¯1
python satellite_inference_server.py --host 127.0.0.1 --port 8080 --satellite_id sat_001

# ç»ˆç«¯2
python satellite_inference_server.py --host 127.0.0.1 --port 8081 --satellite_id sat_002

# ç»ˆç«¯3
python satellite_inference_server.py --host 127.0.0.1 --port 8082 --satellite_id sat_003
```

### æ­¥éª¤4ï¼šé…ç½®åœ°é¢æ§åˆ¶ä¸­å¿ƒ

#### 4.1 ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `multi_satellite_config.json`ï¼š

```json
{
  "satellites": {
    "sat_001": {
      "ip": "127.0.0.1",
      "port": 8080,
      "compute_capacity": 1e12,
      "memory_capacity": 8192,
      "model_version": "v1.0"
    },
    "sat_002": {
      "ip": "127.0.0.1",
      "port": 8081,
      "compute_capacity": 1e12,
      "memory_capacity": 8192,
      "model_version": "v1.0"
    },
    "sat_003": {
      "ip": "127.0.0.1",
      "port": 8082,
      "compute_capacity": 1e12,
      "memory_capacity": 8192,
      "model_version": "v1.0"
    }
  },
  "load_balancing": {
    "strategy": "least_load",
    "health_check_interval": 30,
    "failover_threshold": 3
  },
  "communication": {
    "timeout": 10.0,
    "retry_count": 3,
    "compression": true
  },
  "local_backup": {
    "enabled": true,
    "model_path": "models/best_multimodal_patch_model.pth"
  }
}
```

#### 4.2 å¯åŠ¨åœ°é¢æ§åˆ¶ä¸­å¿ƒ

```bash
python multi_satellite_inference.py
```

### æ­¥éª¤5ï¼šæµ‹è¯•ç³»ç»Ÿ

#### 5.1 è¿è¡Œå®Œæ•´æµ‹è¯•

```bash
python test_multi_satellite.py
```

#### 5.2 æ‰‹åŠ¨æµ‹è¯•

```python
# åˆ›å»ºæµ‹è¯•è„šæœ¬ test_manual.py
import numpy as np
from multi_satellite_inference import MultiSatelliteInferenceSystem

# åˆ›å»ºç³»ç»Ÿ
system = MultiSatelliteInferenceSystem("multi_satellite_config.json")

# å‘ç°å«æ˜Ÿ
system.discover_satellites()

# ç”Ÿæˆæµ‹è¯•æ•°æ®
image_data = np.random.rand(3, 256, 256).astype(np.float32)
sim_features = np.random.rand(11).astype(np.float32)

# æäº¤ä»»åŠ¡
task_id = system.submit_inference_task(
    image_data=image_data,
    sim_features=sim_features,
    priority=5
)

print(f"æäº¤ä»»åŠ¡: {task_id}")

# è·å–ç»“æœ
result = system.get_inference_result(task_id, timeout=60.0)

if result:
    print(f"æ¨ç†æˆåŠŸ: {result['status']}")
    print(f"å¤„ç†æ—¶é—´: {result['processing_time']:.3f}s")
    print(f"å«æ˜ŸID: {result['satellite_id']}")
else:
    print("æ¨ç†å¤±è´¥")
```

è¿è¡Œæ‰‹åŠ¨æµ‹è¯•ï¼š

```bash
python test_manual.py
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æ¨¡å‹åŠ è½½å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âŒ æ¨¡å‹åŠ è½½å¤±è´¥: [Errno 2] No such file or directory: 'models/best_multimodal_patch_model.pth'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la models/

# å¦‚æœä¸å­˜åœ¨ï¼Œä½¿ç”¨å…¶ä»–æ¨¡å‹æ–‡ä»¶
python satellite_inference_server.py --model models/seg_model.pth
```

#### 2. ä¾èµ–åŒ…ç¼ºå¤±

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âŒ ç¼ºå°‘ä¾èµ–: segmentation_models_pytorch
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
pip install segmentation-models-pytorch
```

#### 3. ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```
OSError: [Errno 98] Address already in use
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tulpn | grep 8080

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <PID>

# æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
python satellite_inference_server.py --port 8083
```

#### 4. è¿æ¥è¶…æ—¶

**é”™è¯¯ä¿¡æ¯**ï¼š
```
è¿æ¥è¶…æ—¶
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping 127.0.0.1

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
sudo ufw status

# å¢åŠ è¶…æ—¶æ—¶é—´
# ä¿®æ”¹ multi_satellite_config.json ä¸­çš„ timeout å€¼
```

#### 5. CUDAå†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯**ï¼š
```
CUDA out of memory
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ä½¿ç”¨CPUæ¨¡å¼
export CUDA_VISIBLE_DEVICES=""

# æˆ–å‡å°‘æ‰¹å¤„ç†å¤§å°
# ä¿®æ”¹ä»£ç ä¸­çš„batch_sizeå‚æ•°
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### 1. æŸ¥çœ‹å«æ˜ŸçŠ¶æ€

```python
# è·å–ç³»ç»ŸçŠ¶æ€
status = system.get_system_status()
print(f"åœ¨çº¿å«æ˜Ÿæ•°: {status['online_satellites']}")
print(f"é˜Ÿåˆ—å¤§å°: {status['queue_size']}")

# æŸ¥çœ‹å„å«æ˜Ÿè¯¦ç»†çŠ¶æ€
for sat_id, sat_status in status['satellites'].items():
    print(f"{sat_id}: {sat_status['status']} (è´Ÿè½½: {sat_status['load']:.2f})")
```

### 2. å¯ç”¨è¯¦ç»†æ—¥å¿—

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### 3. æ€§èƒ½ç›‘æ§

```python
# ç›‘æ§å¤„ç†æ—¶é—´
import time

start_time = time.time()
result = system.get_inference_result(task_id)
end_time = time.time()

print(f"æ€»è€—æ—¶: {end_time - start_time:.3f}s")
```

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. çœŸå®å«æ˜Ÿéƒ¨ç½²

åœ¨æ¯ä¸ªå«æ˜Ÿä¸Šï¼š

```bash
# 1. ä¸Šä¼ ä»£ç 
scp -r . user@satellite_ip:/opt/satellite_inference/

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. å¯åŠ¨æœåŠ¡
python satellite_inference_server.py --host 0.0.0.0 --port 8080

# 4. è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable satellite_inference
```

### 2. åœ°é¢æ§åˆ¶ä¸­å¿ƒéƒ¨ç½²

```bash
# 1. é…ç½®å«æ˜ŸIPåœ°å€
vim multi_satellite_config.json

# 2. å¯åŠ¨æ§åˆ¶ä¸­å¿ƒ
python multi_satellite_inference.py

# 3. è®¾ç½®ç›‘æ§
# é…ç½®æ—¥å¿—è½®è½¬ã€å‘Šè­¦ç­‰
```

### 3. è´Ÿè½½å‡è¡¡é…ç½®

```json
{
  "load_balancing": {
    "strategy": "least_load",
    "health_check_interval": 30,
    "failover_threshold": 3,
    "geographic_weight": 0.3,
    "load_weight": 0.4,
    "response_time_weight": 0.3
  }
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ¨¡å‹ä¼˜åŒ–

```python
# ä½¿ç”¨é‡åŒ–æ¨¡å‹
model = torch.quantization.quantize_dynamic(model, {torch.nn.Linear}, dtype=torch.qint8)

# ä½¿ç”¨æ··åˆç²¾åº¦
from torch.cuda.amp import autocast
with autocast():
    output = model(input)
```

### 2. é€šä¿¡ä¼˜åŒ–

```python
# å¯ç”¨æ•°æ®å‹ç¼©
import pickle
import gzip

# å‹ç¼©æ•°æ®
compressed_data = gzip.compress(pickle.dumps(data))
```

### 3. ç¼“å­˜ä¼˜åŒ–

```python
# ç»“æœç¼“å­˜
import functools

@functools.lru_cache(maxsize=1000)
def cached_inference(image_hash):
    # æ¨ç†é€»è¾‘
    pass
```

## ğŸ”’ å®‰å…¨é…ç½®

### 1. é€šä¿¡åŠ å¯†

```python
# ä½¿ç”¨SSL/TLS
import ssl

context = ssl.create_default_context(ssl.Purpose.CLIENT_AUTH)
context.load_cert_chain(certfile="server.crt", keyfile="server.key")
```

### 2. èº«ä»½è®¤è¯

```python
# æ·»åŠ è®¤è¯æœºåˆ¶
def authenticate_client(client_socket):
    # å®ç°è®¤è¯é€»è¾‘
    pass
```

### 3. è®¿é—®æ§åˆ¶

```python
# IPç™½åå•
ALLOWED_IPS = ['192.168.1.101', '192.168.1.102', '192.168.1.103']

def check_ip_whitelist(client_ip):
    return client_ip in ALLOWED_IPS
```

## ğŸ“ æ€»ç»“

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å¯ä»¥æˆåŠŸéƒ¨ç½²å’Œè¿è¡Œå¤šå«æ˜Ÿæ¨ç†ç³»ç»Ÿã€‚ç³»ç»Ÿå…·å¤‡ï¼š

âœ… **é«˜å¯ç”¨æ€§**: å¤šå«æ˜Ÿå†—ä½™ç¡®ä¿ç³»ç»Ÿç¨³å®š  
âœ… **æ™ºèƒ½è°ƒåº¦**: è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»  
âœ… **å®æ—¶ç›‘æ§**: å…¨é¢çš„çŠ¶æ€ç›‘æ§å’Œå‘Šè­¦  
âœ… **æ˜“äºæ‰©å±•**: æ”¯æŒåŠ¨æ€æ·»åŠ æ–°å«æ˜Ÿ  
âœ… **å®‰å…¨å¯é **: å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶  

å¦‚æœåœ¨è¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ã€‚ 